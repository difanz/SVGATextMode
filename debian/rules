#!/usr/bin/make -f
# Converted from the old debstd rules file by Ron Lee <ron@debian.org>
# ..well when I say converted, you'd probably find more water in your
# wine than remnants of the original here, but still.. :-)

package=svgatextmode

HACKPROGS = setVGAreg getVGAreg setpalette getpalette set80 ClockProg


build: build-stamp

build-stamp:
	dh_testdir
	$(MAKE) all
	touch $@

clean:
	dh_testdir
	dh_testroot
	-rm -f build-stamp
	-$(MAKE) mrproper
	-rm -f `find . -name "*~"`
	dh_clean

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	$(MAKE) newinstall DESTDIR=`pwd`/debian/$(package)
	$(MAKE) maninstall DESTDIR=`pwd`/debian/$(package)
	install $(HACKPROGS) `pwd`/debian/$(package)/usr/sbin
	install -m 755 contrib/scripts/STM_reset `pwd`/debian/$(package)/usr/sbin


binary-indep: build install
# no architecture-independent files generated by this package.

binary-arch: build install
	dh_testdir
	dh_testroot
	dh_installdocs
	dh_installexamples
	dh_installinit -n
	dh_installchangelogs HISTORY
	dh_installman 	debian/STM_nocheckfb.5						\
			$(addprefix doc/,TextConfig.man SVGATextMode.man grabmode.man)	\
			contrib/STM_utilities.8
	dh_link usr/share/man/man8/STM_utilities.8 usr/share/man/man8/ClockProg.8	\
		usr/share/man/man8/STM_utilities.8 usr/share/man/man8/STM_reset.8	\
		usr/share/man/man8/STM_utilities.8 usr/share/man/man8/getVGAreg.8	\
		usr/share/man/man8/STM_utilities.8 usr/share/man/man8/getpalette.8	\
		usr/share/man/man8/STM_utilities.8 usr/share/man/man8/setVGAreg.8	\
		usr/share/man/man8/STM_utilities.8 usr/share/man/man8/setpalette.8	\
		usr/share/man/man8/STM_utilities.8 usr/share/man/man8/set80.8

	dh_strip
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch


.PHONY: build clean install binary-indep binary-arch binary

